!function(t,e){"function"==typeof define&&define.amd?define(["jQuery","lodash"],e):"object"==typeof exports?module.exports=e(require("jQuery"),require("lodash")):t.dateTimeInput=e(t.jQuery,t._)}(this,function(i,m){var n,f,o,a,p,t,e={util:{}};return e.util.date={stringToDate:function(n,i){var o;return m.each(["DD/MM/YYYY HH:mm:SS","DD/MM/YYYY HH:mm","DD/MM/YYYY","YYYY-MM-DD HH:mm:SS","YYYY-MM-DD HH:mm","YYYY-MM-DD","LLLL","LLL","LL","L"],function(t){var e=moment(n,t,i);if(e.isValid()
)return o=e.toDate(),!1}),o}},n=["deleteWordBackward","deleteWordForward","deleteSoftLineBackward","deleteSoftLineForward","deleteEntireSoftLine","deleteHardLineBackward","deleteHardLineForward","deleteByDrag","deleteByCut","deleteContent","deleteContentBackward","deleteContentForward"],e.util.event={isDeleteInputEvent:function(t){var e=t.inputType;return-1<n.indexOf(e)}},e.util.regexp={escapeRegExp:function(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}},function(t){function e(t,e,n){
this.element=t,this.options=m.clone(n),this.show=m.noop,this.hide=m.noop,this.destroy=m.noop,this.shouldShow=m.noop,this.shouldHide=m.noop,this.isCompleted=m.noop,this.onOptionsChange=m.noop,this.setOptions(e),this.attachListeners()}e.onDateSelectHoursAction={unchanged:"unchanged",start:"start",end:"end"},e.prototype.setOptions=function(t){m.extend(this.options,t),this.onOptionsChange(t)},e.prototype.attachListeners=function(){var e=this;e.element.addEventListener("focus",function(t){
e.onFocusHandler(t)}),e.element.addEventListener("focusout",function(t){e.onFocusoutHandler(t)}),e.element.addEventListener("input",function(t){e.onInputHandler(t)})},e.prototype.onFocusHandler=function(t){this.shouldShow()&&this.show()},e.prototype.onFocusoutHandler=function(t){this.shouldHide()&&this.hide()},e.prototype.onInputHandler=function(t){this.isCompleted()&&this.hide()},t.Calendar=e}(e),function(p){function t(t,e,n){void 0===n&&(n=!0),this.element=t,this.pattern=e,this.disableFocus=!1
,this.selectedSection=void 0,this.valueModifyListeners=[],this.formatField(),this.attachListeners(n),this.oldValue=this.element.value}t.prototype.attachListeners=function(t){var e=this;e.element.addEventListener("focus",function(t){e.disableFocus||e.onFocusHandler(t)}),e.element.addEventListener("mousedown",function(t){e.onMouseDownHandler(t)}),e.element.addEventListener("mouseup",function(t){e.onMouseUpHandler(t)}),e.element.addEventListener("keydown",function(t){e.onKeyDownHandler(t)}),
t&&e.element.addEventListener("input",function(t){e.inputEventListener(t)})},t.prototype.modifyElementValue=function(t){this.element.value=t,m.each(this.valueModifyListeners,function(t){t()})},t.prototype.inputEventListener=function(t){this.onInputHandler(t),this.oldValue=this.element.value},t.prototype.formatField=function(){var t=this.pattern.stringToDate(this.element.value);this.element.value=this.pattern.dateToString(t)},t.prototype.onFocusHandler=function(t){this.setSelectedSection(m.first(
this.pattern.sections))},t.prototype.onMouseDownHandler=function(t){var e=this;this.pattern.isEmpty(this.element.value)||(this.disableFocus=!0),setTimeout(function(){e.disableFocus=!1})},t.prototype.onMouseUpHandler=function(t){var e=this.pattern.getSectionByIndex(this.element.value,this.element.selectionStart,!0);this.setSelectedSection(e)},t.prototype.onKeyDownHandler=function(t){var e,n;switch(t.key){case"ArrowUp":if(!this.selectedSection)return;this.modifyElementValue(
this.pattern.modifySectionValue(this.element.value,this.selectedSection,1)),this.selectSelectedSection(),t.preventDefault();break;case"ArrowDown":if(!this.selectedSection)return;this.modifyElementValue(this.pattern.modifySectionValue(this.element.value,this.selectedSection,-1)),this.selectSelectedSection(),t.preventDefault();break;case"ArrowLeft":if(t.shiftKey)break;(e=this.pattern.getPrevSection(this.selectedSection,!0))&&this.setSelectedSection(e),t.preventDefault();break;case"ArrowRight":if(
t.shiftKey)break;(n=this.pattern.getNextSection(this.selectedSection,!0))&&this.setSelectedSection(n),t.preventDefault();break;case"Tab":if(t.shiftKey){(e=this.pattern.getPrevSection(this.selectedSection,!0))&&(this.setSelectedSection(e),t.preventDefault());break}(n=this.pattern.getNextSection(this.selectedSection,!0))&&(this.setSelectedSection(n),t.preventDefault())}},t.prototype.onInputHandler=function(n){var e=this,t=this.element.value,i=p.util.date.stringToDate(t,!0),
o=this.pattern.stringToDate(t);if(!i||p.util.event.isDeleteInputEvent(n)||n.data||o){var r=[],s=!0,a=this.pattern.getSectionValues(t),u=this.pattern.getChangedSections(this.oldValue,t);m.each(u,function(t){var e=t.section.processInput(n,t.newValue,t.oldValue,s);e.section=t.section,e.usedData&&(s=!1),m.set(a,t.index,e.validValue),r.push(e)}),this.element.value=a.join("");var c,l=m.find(r,{status:p.Section.status.empty}),d=m.find(r,{status:p.Section.status.invalid}),h=m.find(r,{
status:p.Section.status.completed}),f=m.find(r,{status:p.Section.status.extendable});l||d||f?c=m([l,d,f]).compact().map("section").minBy(function(t){return e.pattern.sections.indexOf(t)}):h&&(c=e.pattern.getNextSection(h.section,!0)),c?this.setSelectedSection(c):this.selectSelectedSection()}else{this.pattern.dateToString(i)!==t&&(this.element.value=this.pattern.dateToString(i))}},t.prototype.setSelectedSection=function(t){
this.selectedSection&&this.selectedSection!==t&&this.selectedSection.clearQueue(),(this.selectedSection=t)&&this.selectSelectedSection()},t.prototype.selectSelectedSection=function(){var t=this.pattern.getSectionCorners(this.element.value,this.selectedSection);t.start===this.element.selectionStart&&t.end===this.element.selectionEnd||this.element.setSelectionRange(t.start,t.end,"forward")},p.Field=t}(e),function(t){function e(t){this.sections=t}e.prototype.getGroupedRegexp=function(){var t=m(
this.sections).map(function(t){return"("+t.regexp.source+")"}).values().join("");return new RegExp(t)},e.prototype.getSectionValues=function(t){var e=this.getGroupedRegexp().exec(t);return e?(e.splice(0,1),e):[]},e.prototype.getNextSection=function(t,e){var n=this.sections.indexOf(t);return m.find(this.sections.slice(n+1),function(t){return!e||t.selectable})},e.prototype.getPrevSection=function(t,e){var n=this.sections.indexOf(t);return m.findLast(this.sections.slice(0,n),function(t){
return!e||t.selectable})},e.prototype.getSectionByIndex=function(t,i,o){var r=0,s=this.getSectionValues(t);return s.length?m.find(this.sections,function(t,e){var n=!o||t.selectable;return r+=m.get(s,e,"").length,i<=r&&n}):m.first(this.sections)},e.prototype.getSectionCorners=function(t,e){var n=this.getSectionValues(t);if(!n.length)return{start:0,end:0};var i=this.sections.indexOf(e),o=m(n.slice(0,i)).sumBy("length");return{start:o,end:o+m.get(n,i,"").length}},
e.prototype.getChangedSections=function(t,e){var i=this,o=this.getSectionValues(t),n=this.getSectionValues(e);if(!o.length||!n.length)return m.map(this.sections,function(t,e){return new s(e,t,"","")});var r=[];return m.each(n,function(t,e){var n=m.get(o,e);t!==n&&r.push(new s(e,m.get(i.sections,e),n,t))}),r;function s(t,e,n,i){this.index=t,this.section=e,this.oldValue=n,this.newValue=i}},e.prototype.isEmpty=function(t){return this.dateToString()===t},e.prototype.dateToString=function(e){
return m.map(this.sections,function(t){return t.dateToString(e)}).join("")},e.prototype.stringToDate=function(t){var n=moment().startOf("year").toDate(),i=this.getSectionValues(t);if(i.length)return m.each(this.sections,function(t,e){t.mapStringToDate(n,m.get(i,e))}),moment(n).isValid()?n:void 0},e.prototype.setSectionValue=function(t,e,n){var i=this.getSectionValues(n);if(i.length){var o=this.sections.indexOf(e);return m.set(i,o,n),i.join("")}},e.prototype.modifySectionValue=function(t,e,n){
var i=this.getSectionValues(t);if(!i.length)return t;var o=this.sections.indexOf(e);return m.set(i,o,e.modifyValue(m.get(i,o),n)),i.join("")},t.Pattern=e}(e),function(u){function c(t){this.length=t.length,this.placeholder=t,this.selectable=!0,this.regexp=/\w*/,this.queueMaxLength=this.length,this.inputQueue=[],this.format=m.noop,this.validate=m.noop,this.modifyDate=m.noop,this.isExtendable=m.noop,this.stringToDate=m.noop}c.status={empty:"empty",invalid:"invalid",completed:"completed",
extendable:"extendable"},c.prototype.dateToString=function(t){return t?this.format(t):this.getPlaceholder()},c.prototype.getPlaceholder=function(){return this.placeholder},c.prototype.mapStringToDate=function(t,e){if(this.validate(e,!0)){var n=this.stringToDate(t,e);t.setTime(n.getTime())}else t.setTime(NaN)},c.prototype.modifyValue=function(t,e){var n,i=moment().startOf("year").toDate(),o=this.stringToDate(i,t);return n=moment(o).isValid()?this.modifyDate(o,e):0<e?i:moment().endOf("year"
).toDate(),this.format(n)},c.prototype.updateInputQueue=function(t){this.inputQueue.push(t),this.inputQueue.splice(0,this.inputQueue.length-this.queueMaxLength)},c.prototype.clearQueue=function(){this.inputQueue.length=0},c.prototype.processInput=function(t,e,n,i){var o=this;if(this.validate(e,!0))return new a(this.isExtendable(e)?c.status.completed:c.status.extendable,!1,e);if(u.util.event.isDeleteInputEvent(t))return this.clearQueue(),new a(c.status.empty,!1,this.getPlaceholder());if(t.data&&i
){this.updateInputQueue(t.data);var r=!1;if(m.each(m.times(this.inputQueue.length),function(t){var e=o.inputQueue.slice(t).join("");if(o.validate(e,!1)){var n=o.isExtendable(e)&&e.length!==o.queueMaxLength,i=o.correct(e);return r=new a(n?c.status.extendable:c.status.completed,!0,i),!1}}),r)return r}if(o.validate(e,!1)){var s=o.correct(e);return new a(o.isExtendable(s)?c.status.extendable:c.status.completed,!1,s)}return new a(c.status.invalid,!1,this.getPlaceholder());function a(t,e,n){
this.status=t,this.usedData=e,this.validValue=n}},u.Section=c}(e),f=e,o={hoursSelectBehaviour:void 0,minViewMode:null,startDate:null,language:"en",endDate:null,onShow:m.noop,onHide:m.noop,onStayInField:m.noop},a=f.sections.hour(),p=f.sections.minute(),f.calendars={bootstrapDatepicker:function(t,u,e){if(!i.fn.datepicker)throw"To install datepicker install it first. https://github.com/uxsolutions/bootstrap-datepicker";var r=i(t),c=!0,l=m.findIndex(u.pattern.sections,{format:a.format}),
d=m.findIndex(u.pattern.sections,{format:p.format}),h=new f.Calendar(r.get(0),e,o);return h.show=function(){var t;t=h.options,r.datepicker({format:{toDisplay:function(t,e,n){t=moment(t).add(-moment(t).utcOffset(),"minutes").toDate();var i=s(r.val());t&&i&&(t.setHours(i.getHours()),t.setMinutes(i.getMinutes()),t.setSeconds(i.getSeconds()),t.setMilliseconds(i.getMilliseconds()));var o=function(t,e,n){var i=moment(t);switch(n.hoursSelectBehaviour){case f.Calendar.onDateSelectHoursAction.unchanged:
if(-1===l||-1===d)return u.pattern.dateToString(i.toDate());var o=u.pattern.dateToString(i.toDate()),r=u.pattern.getSectionValues(o),s=u.pattern.getSectionValues(e);m.set(r,l,m.get(s,l)),m.set(r,d,m.get(s,d));var a=m.find(u.pattern.sections,function(t,e){return t.selectable&&t.getPlaceholder()===m.get(r,e)});return a&&(n.onStayInField(),setTimeout(function(){c=!1,h.element.focus(),u.setSelectedSection(a)})),r.join("");case f.Calendar.onDateSelectHoursAction.end:return i=i.endOf("day"),
u.pattern.dateToString(i.toDate());default:return i=i.startOf("day"),u.pattern.dateToString(i.toDate())}}(t,u.oldValue,h.options);return u.oldValue=o,h.hide(),o},toValue:function(t,e,n){var i,o=s(t);return o&&(i=o,o=moment(i).add(moment(i).utcOffset(),"minutes").toDate()),o}},keyboardNavigation:!1,language:t.language,forceParse:!1,maxViewMode:2,minViewMode:t.minViewMode||null,startDate:t.startDate||null,endDate:t.endDate||null}).on("show",t.onShow).on("hide",t.onHide),r.datepicker("show")},
h.hide=function(){r.datepicker("hide"),n(h.options)},h.destroy=function(){n(h.options)},h.shouldShow=function(){var t=c;return c=!0,t},h.shouldHide=function(){var t=i(".datepicker");return!t.length||!t.is(":hover")},h.isCompleted=function(){return!!u.pattern.stringToDate(h.element.value)},h.onOptionsChange=function(t){var e=r.data("datepicker");e&&("startDate"in t&&e.setStartDate(m.get(t,"startDate",null)),"endDate"in t&&e.setEndDate(m.get(t,"endDate",null)))},h;function n(t){r.datepicker(
"destroy").off("show",t.onShow).off("hide",t.onHide)}function s(t){var e=u.pattern.stringToDate(t);return e||(e=f.util.date.stringToDate(t,!1)),e}}},(t=e).patterns={date:function(){return new t.Pattern([t.sections.day(),t.sections.placeholder("/"),t.sections.month(),t.sections.placeholder("/"),t.sections.year()])},dateTime:function(){return new t.Pattern([t.sections.day(),t.sections.placeholder("/"),t.sections.month(),t.sections.placeholder("/"),t.sections.year(),t.sections.placeholder(" "),
t.sections.hour(),t.sections.placeholder(":"),t.sections.minute()])}},function(n){function e(t){return moment(t).format("HH")}function i(t){return moment(t).format("mm")}n.sections={placeholder:function(t){var e=new n.Section(t);return e.selectable=!1,e.regexp=new RegExp(n.util.regexp.escapeRegExp(t)),e.format=function(t){return this.getPlaceholder()},e.correct=function(t){return this.getPlaceholder()},e.validate=function(t,e){return!e||this.getPlaceholder()===t},e.modifyDate=function(t,e){
return t},e.isExtendable=function(t){return!1},e.stringToDate=function(t,e){return t},e},day:function(){var t=new n.Section("dd");return t.format=function(t){return moment(t).format("DD")},t.correct=function(t){return moment(t+"/01","DD/MM",!1).format("DD")},t.validate=function(t,e){return moment(t+"/01","DD/MM",e).isValid()},t.modifyDate=function(t,e){return moment(t).add(e,"day").toDate()},t.isExtendable=function(t){return+t<=3},t.stringToDate=function(t,e){return isNaN(+e)?new Date(NaN
):moment(t).date(e).toDate()},t},month:function(){var t=new n.Section("mm");return t.format=function(t){return moment(t).format("MM")},t.correct=function(t){return moment(t,"MM",!1).format("MM")},t.validate=function(t,e){return moment(t,"MM",e).isValid()},t.modifyDate=function(t,e){return moment(t).add(e,"month").toDate()},t.isExtendable=function(t){return+t<=1},t.stringToDate=function(t,e){var n=moment(e,"MM",!1),i=moment(t).month(n.month()).toDate();return i.getDate()!==t.getDate()?new Date(
NaN):i},t},year:function(){var t=new n.Section("yyyy");return t.format=function(t){return moment(t).format("YYYY")},t.correct=function(t){return moment(t,"YYYY",!1).format("YYYY")},t.validate=function(t,e){return moment(t,"YYYY",e).isValid()},t.modifyDate=function(t,e){return moment(t).add(e,"year").toDate()},t.isExtendable=function(t){return+t<=2e3},t.stringToDate=function(t,e){return moment(t).year(e).toDate()},t},hour:function(){var t=new n.Section("--");return t.regexp=/[\w-]*/,t.format=e,
t.correct=function(t){return moment(t,"HH",!1).format("HH")},t.validate=function(t,e){return moment(t,"HH",e).isValid()},t.modifyDate=function(t,e){return moment(t).add(e,"hour").toDate()},t.isExtendable=function(t){return+t<=2},t.stringToDate=function(t,e){return isNaN(+e)?new Date(NaN):moment(t).hour(e).toDate()},t},minute:function(){var t=new n.Section("--");return t.regexp=/[\w-]*/,t.format=i,t.correct=function(t){return moment(t,"mm",!1).format("mm")},t.validate=function(t,e){return moment(
t,"mm",e).isValid()},t.modifyDate=function(t,e){return moment(t).add(e,"minute").toDate()},t.isExtendable=function(t){return+t<=6},t.stringToDate=function(t,e){return isNaN(+e)?new Date(NaN):moment(t).minute(e).toDate()},t}}}(e),e});
//# sourceMappingURL=dateTimeInput.min.js.map
